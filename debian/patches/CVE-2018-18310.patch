Index: elfutils-0.159/libdwfl/dwfl_segment_report_module.c
===================================================================
--- elfutils-0.159.orig/libdwfl/dwfl_segment_report_module.c	2019-02-20 15:47:20.322663524 +0100
+++ elfutils-0.159/libdwfl/dwfl_segment_report_module.c	2019-02-20 15:47:20.314663524 +0100
@@ -136,7 +136,10 @@
   inline bool read_portion (void **data, size_t *data_size,
 			    GElf_Addr vaddr, size_t filesz)
   {
-    if (vaddr - start + filesz > buffer_available
+    /* Check whether we will have to read the segment data, or if it
+       can be returned from the existing buffer.  */
+    if (filesz > buffer_available
+	|| vaddr - start > buffer_available - filesz
 	/* If we're in string mode, then don't consider the buffer we have
 	   sufficient unless it contains the terminator of the string.  */
 	|| (filesz == 0 && memchr (vaddr - start + buffer, '\0',
@@ -278,6 +281,12 @@
     if (read_portion (&data, &data_size, vaddr, filesz))
       return;
 
+    /* data_size will be zero if we got everything from the initial
+       buffer, otherwise it will be the size of the new buffer that
+       could be read.  */
+    if (data_size != 0)
+      filesz = data_size;
+
     assert (sizeof (Elf32_Nhdr) == sizeof (Elf64_Nhdr));
 
     void *notes;
